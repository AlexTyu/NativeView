function toggleSlider(){$("#panelThatSlides").is(":visible")&&$("#contentThatFades").fadeOut(600,function(){$("#panelThatSlides").slideUp()}),$("#panelThatSlides2").is(":visible")?$("#contentThatFades2").fadeOut(600,function(){$("#panelThatSlides2").slideUp()}):$("#panelThatSlides").slideDown(600,function(){$("#contentThatFades").fadeIn()})}function drawSpline2D(e,t,a){var n=canCon.lineWidth,o=1/a;canCon.beginPath(),canCon.strokeStyle=t,canCon.lineWidth=.5,canCon.moveTo(e[0],e[1]);for(var i=[],r=0;r<a;r++){var s=o*r,c=Math.pow(1-s,3),l=3*s*Math.pow(1-s,2),d=3*Math.pow(s,2)*(1-s),g=Math.pow(s,3),P=c*e[0]+l*e[2]+d*e[4]+g*e[6],h=c*e[1]+l*e[3]+d*e[5]+g*e[7];i.push([P,h])}i.push([e[6],e[7]]);for(var r=1;r<i.length;r++)canCon.lineTo(i[r][0],i[r][1]),canCon.stroke();canCon.closePath(),canCon.lineWidth=n}function drawPoints2D(e,t,a,n,o,i){V=[],canCon.beginPath(),canCon.closePath();for(var r=0,s=0;s<2*t;s+=2)if(!0===n.FPIsDefined(e[s],e[s+1])){var c=n.getFPPos(e[s],e[s+1])[0]*canvas.width,l=(1-n.getFPPos(e[s],e[s+1])[1])*canvas.height;a===styles.SPLINE?createKnot(c,l):(a===styles.POINT&&(canCon.beginPath(),canCon.fillStyle=BLACK_COLOR,canCon.arc(c,l,i,0,2*Math.PI,!0),canCon.closePath(),canCon.fill(),canCon.beginPath(),canCon.fillStyle=o,canCon.arc(c,l,.6*i,0,2*Math.PI,!0),canCon.closePath(),canCon.fill()),a===styles.LINE&&(r%2==0?(canCon.beginPath(),canCon.moveTo(c,l)):(canCon.lineTo(c,l),canCon.strokeStyle=o,canCon.stroke(),canCon.closePath())),a===styles.LINELOOP&&(0==r?(canCon.beginPath(),canCon.moveTo(c,l)):(canCon.lineTo(c,l),canCon.strokeStyle=o,canCon.stroke(),canCon.closePath(),canCon.beginPath(),canCon.moveTo(c,l)))),r++}if(a===styles.SPLINE){updateSplines();for(var d=0;d<S.length;d++)for(var g=0;g<S[d].length;g+=2)drawSpline2D(S[d],o,splineResolution)}if(a==styles.LINELOOP){var c=n.getFPPos(e[0],e[1])[0]*canvas.width,l=(1-n.getFPPos(e[0],e[1])[1])*canvas.height;canCon.lineTo(c,l),canCon.strokeStyle=o,canCon.stroke(),canCon.closePath()}}function drawFaceFeatures(e){var t=e.faceScale/mWidth*10;drawPoints2D([2,1],1,styles.POINT,e.getFeaturePoints2D(),POINTS_COLOR,t);var a=[2,2,2,6,2,4,2,8,2,3,2,9,2,5,2,7],n=[2,5,2,7,2,2,2,6,2,4],o=[2,5,2,9,2,3,2,8,2,4];drawPoints2D(n,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(o,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(a,8,styles.POINT,e.getFeaturePoints2D(),POINTS_COLOR,t);var i=[8,1,8,10,8,5,8,3,8,7,8,2,8,8,8,4,8,6,8,9],r=[8,4,8,6,8,9,8,1],s=[8,1,8,10,8,5,8,3],c=[8,4,8,8,8,2,8,7,8,3];drawPoints2D(r,4,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(s,4,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(c,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(i,10,styles.POINT,e.getFeaturePoints2D(),POINTS_COLOR,t);var l=[9,1,9,2,9,3,9,15],d=[9,1,9,3,9,2];if(drawPoints2D(l,4,styles.POINT,e.getFeaturePoints2D(),POINTS_COLOR,t),drawPoints2D(d,3,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),e.getEyeClosure()[0]){var g=[3,60];drawPoints2D(g,1,styles.POINT,e.getFeaturePoints2D(),IRIS_COLOR,t)}if(e.getEyeClosure()[1]){var g=[3,50];drawPoints2D(g,1,styles.POINT,e.getFeaturePoints2D(),IRIS_COLOR,t)}var P=[3,2,3,4,3,8,3,10,3,12,3,14,12,6,12,8,12,10,12,12],h=[3,1,3,3,3,7,3,9,3,11,3,13,12,5,12,7,12,9,12,11],u=[3,12,3,14,3,8],v=[3,12,3,10,3,8],C=[3,12,12,10,3,2,12,6,3,8],O=[3,12,12,12,3,4,12,8,3,8],m=[3,11,3,13,3,7],S=[3,11,3,9,3,7],w=[3,11,12,9,3,1,12,5,3,7],L=[3,11,12,11,3,3,12,7,3,7];e.getEyeClosure()[1]?drawPoints2D(P,10,styles.POINT,e.getFeaturePoints2D(),POINTS_COLOR,t):e.getEyeClosure()[1]||drawPoints2D(P,10,styles.POINT,e.getFeaturePoints2D(),BLACK_COLOR,t),e.getEyeClosure()[0]?drawPoints2D(h,10,styles.POINT,e.getFeaturePoints2D(),POINTS_COLOR,t):e.getEyeClosure()[0]||drawPoints2D(h,10,styles.POINT,e.getFeaturePoints2D(),BLACK_COLOR,t),drawPoints2D(u,3,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(v,3,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(C,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(O,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(m,3,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(S,3,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(w,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(L,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR);var F=[4,1,4,2,4,3,4,4,4,5,4,6,14,1,14,2,14,3,14,4],I=[4,6,14,4,4,4,14,2,4,2],T=[4,1,14,1,4,3,14,3,4,5];drawPoints2D(I,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(T,5,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(F,10,styles.POINT,e.getFeaturePoints2D(),POINTS_COLOR,t);var f=[13,1,13,3,13,5,13,7,13,9,13,11,13,13,13,15,13,17,13,16,13,14,13,12,13,10,13,8,13,6,13,4,13,2];drawPoints2D(f,17,styles.SPLINE,e.getFeaturePoints2D(),SPLINES_COLOR),drawPoints2D(f,17,styles.POINT,e.getFeaturePoints2D(),POINTS_COLOR,t)}function testConfig(){var e=document.getElementById("myList"),t="../../lib/"+e.options[e.selectedIndex].text;m_Tracker.setTrackerConfiguration(t)}function multiplyMatrix(e,t,a,n,o){for(var i=[],r=0;r<a;++r)for(var s=0;s<o;++s){for(var c=0,l=0;l<n;++l)c+=e[r*n+l]*t[l*o+s];i[r*o+s]=c}return i}function drawFaceModelAxes(e){var t=3,a=1,n=1;canvas.width>canvas.height?a=canvas.width/canvas.height:canvas.width<canvas.height&&(n=canvas.height/canvas.width);var o=.001,i=30,r=.001*a/3,s=.001*n/3,c=(r-r)/(r+r),l=(s-s)/(s+s),d=-30.001/29.999,g=-.06/29.999,P=.002/(r+r),h=.002/(s+s),u=[P,0,0,0,0,h,0,0,c,l,d,-1,0,0,g,0],v=[0,0,10],C=[0,0,0],O=[-1,0,0],m=[0,-1,0],S=[0,0,1],w=Math.sin(-e.getFaceRotation()[0]),L=Math.sin(e.getFaceRotation()[1]),F=Math.sin(-e.getFaceRotation()[2]),I=Math.cos(e.getFaceRotation()[0]),T=Math.cos(e.getFaceRotation()[1]),f=Math.cos(e.getFaceRotation()[2]),D=T*f+w*L*F,y=-T*F+w*L*f,R=I*L,p=I*F,_=I*f,E=-w,N=-L*f+w*T*F,A=L*F+w*T*f,M=I*T,k=[0,0,0];k[0]=1*(D*C[0]+y*C[1]+R*C[2]),k[1]=1*(p*C[0]+_*C[1]+E*C[2]),k[2]=1*(N*C[0]+A*C[1]+M*C[2]);var b=[0,0,0];b[0]=1*(D*O[0]+y*O[1]+R*O[2]),b[1]=1*(p*O[0]+_*O[1]+E*O[2]),b[2]=1*(N*O[0]+A*O[1]+M*O[2]);var x=[0,0,0];x[0]=1*(D*m[0]+y*m[1]+R*m[2]),x[1]=1*(p*m[0]+_*m[1]+E*m[2]),x[2]=1*(N*m[0]+A*m[1]+M*m[2]);var G=[0,0,0];G[0]=1*(D*S[0]+y*S[1]+R*S[2]),G[1]=1*(p*S[0]+_*S[1]+E*S[2]),G[2]=1*(N*S[0]+A*S[1]+M*S[2]);var U=[k[0],k[1],k[2]-v[2],1],W=multiplyMatrix(U,u,1,4,4),B=[b[0],b[1],b[2]-v[2],1],H=multiplyMatrix(B,u,1,4,4),K=[x[0],x[1],x[2]-v[2],1],z=multiplyMatrix(K,u,1,4,4),V=[G[0],G[1],G[2]-v[2],1],q=multiplyMatrix(V,u,1,4,4),X=e.getFeaturePoints2D().getFP(4,1),Z=e.getFeaturePoints2D().getFP(4,2),Y=[];1===X.defined&&1===Z.defined&&(Y[0]=(X.getPos(0)+Z.getPos(0))/2,Y[1]=1-(X.getPos(1)+Z.getPos(1))/2);var j=[Y[0]*canvas.width,Y[1]*canvas.height],J=[0,0,0],Q=[0,0,0];Q[0]=(W[0]/W[3]+1)*canvas.width/2,Q[1]=(W[1]/W[3]+1)*canvas.height/2,Q[2]=(W[2]/W[3]+1)/2,J[0]=(H[0]/H[3]+1)*canvas.width/2,J[1]=(H[1]/H[3]+1)*canvas.height/2,J[2]=(H[2]/H[3]+1)/2,canCon.beginPath(),canCon.moveTo(j[0],j[1]),canCon.lineTo(j[0]+(J[0]-Q[0]),j[1]+(J[1]-Q[1])),canCon.strokeStyle=X_AXIS_COLOR,canCon.lineWidth=3,canCon.stroke(),canCon.closePath(),J[0]=(z[0]/z[3]+1)*canvas.width/2,J[1]=(z[1]/z[3]+1)*canvas.height/2,J[2]=(z[2]/z[3]+1)/2,canCon.beginPath(),canCon.moveTo(j[0],j[1]),canCon.lineTo(j[0]+(J[0]-Q[0]),j[1]+(J[1]-Q[1])),canCon.strokeStyle=Y_AXIS_COLOR,canCon.lineWidth=3,canCon.stroke(),canCon.closePath(),J[0]=(q[0]/q[3]+1)*canvas.width/2,J[1]=(q[1]/q[3]+1)*canvas.height/2,J[2]=(q[2]/q[3]+1)/2,canCon.beginPath(),canCon.moveTo(j[0],j[1]),canCon.lineTo(j[0]+(J[0]-Q[0]),j[1]+(J[1]-Q[1])),canCon.strokeStyle=Z_AXIS_COLOR,canCon.lineWidth=3,canCon.stroke(),canCon.closePath()}function drawGaze(e){if(e.getEyeClosure()[1]){var t=e.cameraFocus,a=1,n=1;canvas.width>canvas.height?a=canvas.width/canvas.height:canvas.width<canvas.height&&(n=canvas.height/canvas.width);var o=.001,i=30,r=.001*a/t,s=.001*n/t,c=(r-r)/(r+r),l=(s-s)/(s+s),d=-30.001/29.999,g=-.06/29.999,P=.002/(r+r),h=.002/(s+s),u=[P,0,0,0,0,h,0,0,c,l,d,-1,0,0,g,0],v=[0,0,1],C=[0,0,10],O=[0,0,0],m=Math.sin(e.getGazeDirectionGlobal()[0]),S=Math.sin(e.getGazeDirectionGlobal()[1]),w=Math.sin(e.getGazeDirectionGlobal()[2]),L=Math.cos(e.getGazeDirectionGlobal()[0]),F=Math.cos(e.getGazeDirectionGlobal()[1]),I=Math.cos(e.getGazeDirectionGlobal()[2]),T=F*I+m*S*w,f=-F*w+m*S*I,D=L*S,y=L*w,R=L*I,p=-m,_=-S*I+m*F*w,E=S*w+m*F*I,N=L*F,A=[0,0,0];A[0]=1*(T*v[0]+f*v[1]+D*v[2]),A[1]=1*(y*v[0]+R*v[1]+p*v[2]),A[2]=1*(_*v[0]+E*v[1]+N*v[2]);var M=[0,0,0];M[0]=1*(T*O[0]+f*O[1]+D*O[2]),M[1]=1*(y*O[0]+R*O[1]+p*O[2]),M[2]=1*(_*O[0]+E*O[1]+N*O[2]);var k=[M[0],M[1],M[2]-C[2],1],b=multiplyMatrix(k,u,1,4,4),x=[A[0],A[1],A[2]-C[2],1],G=multiplyMatrix(x,u,1,4,4);b[0]=(b[0]/b[3]+1)/2,b[1]=(b[1]/b[3]+1)/2,b[2]=(b[2]/b[3]+1)/2,G[0]=(G[0]/G[3]+1)/2,G[1]=(G[1]/G[3]+1)/2,G[2]=(G[2]/G[3]+1)/2;var U=e.getFeaturePoints2D().getFP(3,5),W=e.getFeaturePoints2D().getFP(3,6),B=[],H=[];1===U.defined&&1===W.defined&&(B[0]=U.getPos(0),B[1]=U.getPos(1),H[0]=W.getPos(0),H[1]=W.getPos(1));var K=G[0]-b[0]+B[0],z=G[1]-b[1]+B[1],V=G[0]-b[0]+H[0],q=G[1]-b[1]+H[1];canCon.beginPath(),canCon.moveTo(B[0]*canvas.width,(1-B[1])*canvas.height),canCon.lineTo(K*canvas.width,(1-z)*canvas.height),canCon.strokeStyle=GAZE_COLOR,canCon.lineWidth=2,canCon.stroke(),canCon.closePath(),canCon.beginPath(),canCon.moveTo(H[0]*canvas.width,(1-H[1])*canvas.height),canCon.lineTo(V*canvas.width,(1-q)*canvas.height),canCon.strokeStyle=GAZE_COLOR,canCon.lineWidth=2,canCon.stroke()}}function callbackDownload(){StartTracker()}function checkFrameDuplicate(e){for(var t=0;t<e.length;t+=2)if(e[t]!==frameSample[t])return!1;for(var t=1;t<e.length;t+=2)if(e[t]!==frameSample[t])return!1;return!0}function processFrame(){function e(){var t=faceData;streamData(t),requestAnimationFrame(e)}if(window.requestAnimationFrame(processFrame),now=Date.now(),(delta=now-then)>interval){for(then=now-delta%interval,canvas.width=mWidth,canCon.drawImage(video,0,0,mWidth,mHeight),imageData=canCon.getImageData(0,0,mWidth,mHeight).data,i=0;i<imageData.length;i+=1)pixels[i]=imageData[i];if(!0===startTracking&&(trackerReturnState=m_Tracker.track(mWidth,mHeight,ppixels,faceDataArray,Module.VisageTrackerImageFormat.VISAGE_FRAMEGRABBER_FMT_RGBA.value,Module.VisageTrackerOrigin.VISAGE_FRAMEGRABBER_ORIGIN_TL.value,0,-1,maxFaces)),!0===startTracking&&trackerReturnState.get(0)===Module.VisageTrackerStatus.TRACK_STAT_OK.value&&!0===draw){var t=faceDataArray.get(0);drawFaceFeatures(t),drawGaze(t),drawFaceModelAxes(t)}transOutput.innerHTML="["+faceDataArray.get(0).getFaceTranslation()[0].toFixed(2)+","+faceDataArray.get(0).getFaceTranslation()[1].toFixed(2)+","+faceDataArray.get(0).getFaceTranslation()[2].toFixed(2)+"]",rotOutput.innerHTML="["+faceDataArray.get(0).getFaceRotation()[0].toFixed(2)+","+faceDataArray.get(0).getFaceRotation()[1].toFixed(2)+","+faceDataArray.get(0).getFaceRotation()[2].toFixed(2)+"]",fpsTracker.innerHTML=faceDataArray.get(0).frameRate.toFixed(2)}trackerReturnState.get(0)!==Module.VisageTrackerStatus.TRACK_STAT_OK.value&&(maleNum=0,femaleNum=0),statOutput.innerHTML="["+trackerStates[trackerReturnState.get(0)]+"]";var a=1e3/((now=new Date)-lastUpdate);fps+=(a-fps)/fpsFilter,lastUpdate=now,requestAnimationFrame(e)}function StartTracker(){startTracking=!0}function StopTracker(){startTracking=!1}function deniedStream(){alert("Camera access denied!)")}function errorStream(e){e&&console.error(e)}function onModuleInitialized(){if(0===mWidth)return void setTimeout(onModuleInitialized,100);ppixels=Module._malloc(mWidth*mHeight*4),pixels=new Uint8Array(Module.HEAPU8.buffer,ppixels,mWidth*mHeight*4),Module.initializeLicenseManager("492-209-201-108-805-336-029-013-891-329-010.vlc"),m_Tracker=new Module.VisageTracker("../../lib/Facial Features Tracker - High.cfg"),maxFaces=1,faceDataArray=new Module.FaceDataVector;for(var e=0;e<maxFaces;++e)faceData=new Module.FaceData,faceDataArray.push_back(faceData);var t=new Module.VectorFloat;t=trackerStates[0],processFrame()}function startStream(e){video.addEventListener("canplay",function e(){video.removeEventListener("canplay",e,!0),setTimeout(function(){video.play(),canvas.width=video.videoWidth,canvas.height=video.videoHeight,mWidth=video.videoWidth,mHeight=video.videoHeight},1e3)},!0);var t=window.URL||window.webkitURL;video.src=t?t.createObjectURL(e):e,video.play()}var fpsOut=document.getElementById("boldStuff"),fpsTracker=document.getElementById("fpsTracker"),transOutput=document.getElementById("myTrans"),rotOutput=document.getElementById("myRot"),statOutput=document.getElementById("myStat"),canvas=document.getElementById("canvas"),mWidth=0;mHeight=0;var fps=0,now=0,lastUpdate=0;fpsFilter=50;var canCon=canvas.getContext("2d"),startTracking=!1,draw=!0,splineResolution=1,IRIS_COLOR="rgba(200,80,0,255)",GAZE_COLOR="rgba(240,96,0,255)",BLACK_COLOR="#000000",POINTS_COLOR="rgba(0,255,255,255)",SPLINES_COLOR="rgba(176,196,222,160)",X_AXIS_COLOR="rgba(255,0,0,0.2)",Y_AXIS_COLOR="rgba(0,255,0,0.2)",Z_AXIS_COLOR="rgba(0,0,255,0.2)",styles={LINE:0,LINELOOP:1,POINT:2,SPLINE:3};setInterval(function(){fpsOut.innerHTML=fps.toFixed(1)+" fps"},10);var timeme=!1,trackerStates=["TRACK_STAT_OFF","TRACK_STAT_OK","TRACK_STAT_RECOVERING","TRACK_STAT_INIT"],frameSample=[0,0,0,0,0],newSample=[0,0,0,0,0],ppixels,pixels,fpsLimit=30,now,then=Date.now(),interval=1e3/fpsLimit,delta,m_Tracker,imageData,video=document.createElement("video");window.URL=window.URL||window.webkitURL,navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,function(){for(var e=0,t=0,a=["ms","moz","webkit","o"];e<a.length&&!window.requestAnimationFrame;)window.requestAnimationFrame=window[a[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[e]+"CancelAnimationFrame"]||window[a[e]+"CancelRequestAnimationFrame"],e++;window.requestAnimationFrame||alert("RequestAnimationFrame mechanism is not supported by this browser.")}();try{navigator.getUserMedia_({video:!0,audio:!1},startStream,deniedStream)}catch(e){try{navigator.getUserMedia_("video",startStream,deniedStream)}catch(e){errorStream(e)}}video.loop=video.muted=!0,video.autoplay=!0,video.load();